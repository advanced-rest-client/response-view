<!doctype html>
<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">

    <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
    <script src="../../web-component-tester/browser.js"></script>
    <script src="../../iron-test-helpers/test-helpers.js"></script>
    <script src="../../iron-test-helpers/mock-interactions.js"></script>

    <link rel="import" href="../../fetch-polyfill/fetch-polyfill.html">
    <link rel="import" href="../../promise-polyfill/promise-polyfill-lite.html">
    <link rel="import" href="../response-view.html">
  </head>
  <body>

    <test-fixture id="basic">
      <template>
        <response-view></response-view>
      </template>
    </test-fixture>

    <script>
    /* global suite, test, fixture, assert, TestHelpers */
    suite('basic', function() {

      function createRequest(method, url, headers, body) {
        url = url || 'http://domain.com';
        var demoHeaders = new Headers(headers || {});
        var opts = {
          method: method || 'GET',
          mode: 'cors',
          headers: demoHeaders
        };
        if (body) {
          opts.body = body;
        }
        return new Request(url, opts);
      }

      function generateResponse(body, code, status, headers) {
        var init = {
          status: code || 200,
          statusText: status || '',
          headers: headers || new Headers()
        };
        return new Response(body, init);
      }

      var element;
      setup(function() {
        element = fixture('basic');
        element.request = createRequest();
        element.response = generateResponse('{"test":true}', 200, 'OK', {
          'content-type': 'application/json'
        });
      });

      test('Should set status code', function() {
        assert.equal(element.statusCode, 200);
      });

      test('Should set status message', function() {
        assert.equal(element.statusMessage, 'OK');
      });

      test('Should set response headers', function() {
        assert.equal(element.responseHeaders, 'content-type: application/json');
      });

      test('Should set hasResponse to true', function() {
        assert.equal(element.hasResponse, true);
      });

      test('Should set isError to false', function() {
        assert.equal(element.hasResponse, true);
      });

      test('Should set response content type', function(done) {
        TestHelpers.forceXIfStamp(element);
        // Content type is set async so it has to wait a moment.
        setTimeout(function() {
          assert.equal(element.contentType, 'application/json');
          done();
        }, 250);
      });

      test('Should set response body', function(done) {
        // responseBody is set async so it has to wait a moment.
        setTimeout(function() {
          assert.equal(element.responseBody, '{"test":true}');
          done();
        }, 250);
      });
    });
    </script>

  </body>
</html>
